---
sidebar: sidebar 
permalink: migration/shift-toolkit-migrate-esxi2olvm.html 
keywords: netapp, vmware, esxi, vm, migration, virtualization, oracle, linux, olvm 
summary: Migrieren Sie VMs von VMware ESXi zu Oracle Linux Virtualization Manager mithilfe des Shift Toolkits, indem Sie VMs vorbereiten, Festplattenformate konvertieren und die Zielumgebung konfigurieren. 
---
= Migrieren von VMs von VMware ESXi zu Oracle Linux Virtualization Manager
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Migrieren Sie VMs von VMware ESXi zu Oracle Linux Virtualization Manager (OLVM) mithilfe des Shift Toolkits, indem Sie VMs vorbereiten, Festplattenformate konvertieren und die Zielumgebung konfigurieren.

Das Shift Toolkit ermöglicht die VM-Migration zwischen Virtualisierungsplattformen durch Konvertierung des Festplattenformats und Neukonfiguration des Netzwerks in der Zielumgebung.



== Bevor Sie beginnen

Bitte vergewissern Sie sich vor Beginn der Migration, dass die folgenden Voraussetzungen erfüllt sind.

.Anforderungen an Oracle Linux Virtualization Manager
* Oracle Linux Virtualization Manager mit Oracle Linux KVM-Hosts, die dem Rechenzentrum hinzugefügt wurden
* ONTAP NFS-Speicher als Speicherdomäne hinzugefügt
* Administratorrechte auf dem Cluster
* Oracle Linux Virtualization Manager und VDSM-Versionen sind >= 4.5
* Oracle Linux Virtualization Manager (Ziel-)Hosts sind netzwerkweit erreichbar
* NFSv3-Speicherdomäne mit dem entsprechenden Volume und Qtree konfiguriert.
+
** Stellen Sie sicher, dass der VDSM-Benutzer (UID 36) und die KVM-Gruppe (GID 36) Lese- und Schreibzugriff haben.


* Netzwerke, die mit den entsprechenden VLANs konfiguriert sind


.VMware-Anforderungen
* VM-VMDKs werden auf einem NFSv3-Volume abgelegt (alle VMDKs einer bestimmten VM sollten Teil desselben Volumes sein).
* VMware-Tools laufen auf den Gast-VMs.
* Die zu migrierenden VMs befinden sich zur Vorbereitung im Status „Wird ausgeführt“.
* Die VMs müssen vor dem Auslösen der Migration ausgeschaltet werden.
* Die Entfernung der VMware Tools erfolgt auf dem Zielhypervisor, sobald die VMs eingeschaltet sind.


.Anforderungen an die Gast-VM
* Für Windows-VMs: Verwenden Sie lokale Administratorrechte.
* Für Linux-VMs: Verwenden Sie einen Benutzer mit Berechtigungen zur Ausführung von sudo-Befehlen ohne Passwortabfrage.
* Für Windows-VMs: Binden Sie die VirtIO-ISO-Datei in die VM ein (Download vonlink:https://fedorapeople.org/groups/virt/virtio-win/direct-downloads/archive-virtio/virtio-win-0.1.271-1/virtio-win-0.1.271.iso["hier,"] )
+

NOTE: Das Vorbereitungsskript verwendet das .msi-Paket, um Treiber und qemu-Gastagenten zu installieren.





== Schritt 1: Zielstandort (OLVM) hinzufügen

Fügen Sie die Zielumgebung des Oracle Linux Virtualization Manager zum Shift Toolkit hinzu.

.Schritte
. Klicken Sie auf *Neue Website hinzufügen* und wählen Sie *Ziel* aus.
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-200.png[Ziel auswählen]

====
. Geben Sie die Details des Zielortes ein:
+
** *Name der Website*: Geben Sie einen Namen für die Website an.
** *Hypervisor*: OLVM auswählen
** *Standort*: Standardoption auswählen
** *Connector*: Standardauswahl auswählen


. Klicken Sie auf *Weiter*.
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-201.png[Details zum Reiseziel]

====
. Geben Sie die OLVM-Details ein:
+
** *Endpunkt*: IP-Adresse oder FQDN des Virtualisierungsmanagers
** *Benutzername*: Benutzername im Format Benutzername@Profil (zum Beispiel admin@internal)
** *Passwort*: Passwort für den Zugriff auf den Virtualisierungsmanager


. Wählen Sie *Selbstsigniertes Zertifikat akzeptieren* und klicken Sie auf *Weiter*.
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-202.png[OLVM-Zieldetails]

====
. Klicken Sie auf *Site erstellen*.
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-203.png[Erstellung eines OLVM-Ziels]

====
+

NOTE: Quell- und Zielvolume bleiben identisch, da die Formatkonvertierung auf Volume-Ebene innerhalb desselben Volumes erfolgt.





== Schritt 2: Ressourcengruppen erstellen

Organisieren Sie VMs in Ressourcengruppen, um die Bootreihenfolge und die Bootverzögerungskonfigurationen beizubehalten.

.Bevor Sie beginnen
* Stellen Sie sicher, dass Qtrees gemäß den Voraussetzungen bereitgestellt werden.
* Verschieben Sie VMs vor der Konvertierung auf einen dafür vorgesehenen Datenspeicher auf einer neu erstellten ONTAP SVM, um die Produktions-NFS-Datenspeicher vom Staging-Bereich zu isolieren.


.Schritte
. Navigieren Sie zu *Ressourcengruppen* und klicken Sie auf *Neue Ressourcengruppe erstellen*.
. Wählen Sie die Quellseite aus dem Dropdown-Menü aus und klicken Sie auf *Erstellen*.
. Geben Sie Details zur Ressourcengruppe an und wählen Sie den Workflow aus:
+
** *Klonbasierte Migration*: Führt eine vollständige Migration vom Quell- zum Ziel-Hypervisor durch.
** *Klonbasierte Konvertierung*: Konvertiert das Festplattenformat in den ausgewählten Hypervisor-Typ


. Klicken Sie auf *Weiter*.
. Wählen Sie VMs mithilfe der Suchoption aus (Standardfilter ist „Datenspeicher“).
+

NOTE: Im Dropdown-Menü für Datenspeicher werden nur NFSv3-Datenspeicher angezeigt.  NFSv4-Datenspeicher werden nicht angezeigt.

. Migrationsdetails aktualisieren:
+
** *Zielort auswählen*
** Wählen Sie *Ziel-OLVM-Eintrag* aus.
** Konfiguration der Datenspeicher-zu-Qtree-Zuordnung
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-204.png[Migrationsdetails]

====
+

NOTE: Stellen Sie sicher, dass beim Konvertieren von VMs von ESXi zu OLVM der Zielpfad (wo die konvertierten VMs gespeichert werden) auf einen Qtree festgelegt ist.  Stellen Sie außerdem sicher, dass dieser Qtree der Speicherdomäne hinzugefügt wird.  Es können mehrere Qtrees erstellt und zur Speicherung konvertierter VM-Festplatten verwendet werden.



. Konfigurieren Sie die Bootreihenfolge und die Bootverzögerung für alle ausgewählten VMs:
+
** *1*: Erste VM, die eingeschaltet wird
** *3*: Standard
** *5*: Letzte VM, die eingeschaltet wird


. Klicken Sie auf *Ressourcengruppe erstellen*.
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-205.png[Details zur Ressourcengruppe]

====


.Ergebnis
Die Ressourcengruppe wurde erstellt und ist bereit für die Blueprint-Konfiguration.



== Schritt 3: Erstellen Sie einen Migrationsplan

Erstellen Sie einen Entwurf zur Definition des Migrationsplans, einschließlich Plattformzuordnungen, Netzwerkkonfiguration und VM-Einstellungen.

.Schritte
. Navigieren Sie zu *Blueprints* und klicken Sie auf *Create New Blueprint*.
. Geben Sie einen Namen für die Blaupause an und konfigurieren Sie die Hostzuordnungen:
+
** Wählen Sie *Quellstandort* und das zugehörige vCenter aus.
** Wählen Sie den *Zielstandort* und das zugehörige OLVM-Ziel aus.
** Cluster- und Hostzuordnung konfigurieren
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-206.png[Details der Bauzeichnung]

====


. Wählen Sie die Details der Ressourcengruppe aus und klicken Sie auf *Weiter*.
. Legen Sie die Ausführungsreihenfolge für Ressourcengruppen fest, falls mehrere Gruppen vorhanden sind.
. Konfigurieren Sie die Netzwerkzuordnung zu den entsprechenden logischen Netzwerken.
+

NOTE: Die Netzwerke sollten in OLVM bereits mit der entsprechenden VLAN-Kennzeichnung bereitgestellt sein.  Wählen Sie für Testmigrationen die Option „Netzwerk nicht konfigurieren“, um Konflikte mit dem Produktionsnetzwerk zu vermeiden; weisen Sie die Netzwerkeinstellungen nach der Konvertierung manuell zu.

+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-207.png[Netzwerk-Mapping]

====
. Speicherzuordnungen überprüfen (automatisch basierend auf der VM-Auswahl ausgewählt).
+

NOTE: Stellen Sie sicher, dass der Qtree im Voraus bereitgestellt und die erforderlichen Berechtigungen zugewiesen sind, damit die virtuelle Maschine vom NFS-Volume erstellt und eingeschaltet werden kann.

. Wählen Sie unter VM-Details die Konfigurationsdetails aus und geben Sie die Anmeldeinformationen des Dienstkontos für jeden Betriebssystemtyp an:
+
** *Windows*: Verwenden Sie einen Benutzer mit lokalen Administratorrechten (Domänenanmeldeinformationen können auch verwendet werden).
** *Linux*: Verwenden Sie einen Benutzer, der sudo-Befehle ohne Passwortabfrage ausführen kann.
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-208.png[Details zur Konfigurationszuordnung]

====
+

NOTE: Die Konfigurationsauswahl ermöglicht es Ihnen, das Festplattenabbildformat auszuwählen und die Überschreibung prepareVM zu überspringen.  Der Workflow verwendet standardmäßig das QCOW2-Format, bei Bedarf kann aber auch das RAW-Format ausgewählt werden.  Die Option „prepareVM überschreiben“ ermöglicht es Administratoren, die VM-Vorbereitung zu überspringen und benutzerdefinierte Skripte auszuführen.



. IP-Einstellungen konfigurieren:
+
** *Nicht konfigurieren*: Standardoption
** *IP-Adressen beibehalten*: Die gleichen IP-Adressen wie im Quellsystem beibehalten
** *DHCP*: DHCP den Ziel-VMs zuweisen
+
Stellen Sie sicher, dass die VMs während der prepareVM-Phase eingeschaltet sind und die VMware Tools installiert sind.



. VM-Einstellungen konfigurieren:
+
** CPU/RAM-Parameter anpassen (optional)
** Bootreihenfolge und Bootverzögerung ändern
** *Einschalten*: Wählen Sie diese Option, um die VMs nach der Migration einzuschalten (Standard: EIN).
** *VMware Tools entfernen*: VMware Tools nach der Konvertierung entfernen (Standard: ausgewählt)
** *VM-Firmware*: BIOS > BIOS und EFI > EFI (automatisch)
** *MAC-Adressen beibehalten*: MAC-Adressen für Lizenzierungsanforderungen aufbewahren
** *Dienstkonto-Überschreibung*: Geben Sie bei Bedarf ein separates Dienstkonto an.


. Klicken Sie auf *Weiter*.
. Planen Sie die Migration, indem Sie ein Datum und eine Uhrzeit auswählen.
+

NOTE: Planen Sie Migrationen mindestens 30 Minuten im Voraus, um genügend Zeit für die VM-Vorbereitung zu haben.

. Klicken Sie auf *Blueprint erstellen*.


.Ergebnis
Das Shift Toolkit initiiert einen prepareVM-Job, der Skripte auf den Quell-VMs ausführt, um diese für die Migration vorzubereiten.

.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-209.png[OLVM-Vorbereitungsdetails]

====
Der Vorbereitungsprozess:

* Fügt Skripte ein, um VirtIO-Treiber zu aktualisieren, den qemu-Agenten zu installieren, VMware Tools zu entfernen, IP-Details zu sichern und die fstab-Datei zu aktualisieren.
* Verwendet PowerCLI, um eine Verbindung zu Gast-VMs (Linux oder Windows) herzustellen und VirtIO-Treiber zu aktualisieren.
* Für Windows-VMs: Speichert Skripte in `C:\NetApp`
* Für Linux-VMs: Speichert Skripte in `/NetApp` Und `/opt`



NOTE: Für alle unterstützten VM-Betriebssysteme installiert das Shift Toolkit automatisch die notwendigen VirtIO-Treiber vor der Festplattenkonvertierung, um einen erfolgreichen Start nach der Konvertierung zu gewährleisten.

Wenn prepareVM erfolgreich abgeschlossen wird, aktualisiert sich der Blueprint-Status auf „PrepareVM Complete“.  Die Migration erfolgt nun zum geplanten Zeitpunkt oder kann manuell durch Anklicken der Option *Migrieren* gestartet werden.

.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-210.png[Auswahl im Migrationsmenü]

====


== Schritt 4: Migration ausführen

Den Migrationsworkflow auslösen, um VMs von VMware ESXi zu Oracle Linux Virtualization Manager zu konvertieren.

.Bevor Sie beginnen
Alle VMs werden gemäß dem geplanten Wartungsplan ordnungsgemäß heruntergefahren.

.Schritte
. Klicken Sie im Blueprint auf *Migrieren*.
+
.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-211.png[Migrationsschritte]

====
. Das Shift Toolkit führt folgende Aktionen aus:
+
** Löscht vorhandene Snapshots für alle VMs im Blueprint.
** Löst VM-Snapshots an der Quelle aus
** Löst einen Volume-Snapshot vor der Festplattenkonvertierung aus.
** Konvertiert VMDK-Dateien für alle VMs in das QCOW2- oder RAW-Format.
+
Das Shift Toolkit findet automatisch alle VMDKs, die mit jeder VM verknüpft sind, einschließlich der primären Boot-Disk.

+

NOTE: Wenn mehrere VMDK-Dateien vorhanden sind, wird jede VMDK-Datei konvertiert.

** Lädt das QCOW2- oder RAW-Image in die OLVM-Speicherdomäne hoch.
+
Nachdem das virtuelle Maschinen-Disk-Image in das QCOW2- oder RAW-Format konvertiert wurde, lädt das Shift Toolkit die Datei in die entsprechende Speicherdomäne hoch und fügt jede Festplatte hinzu.

** Erstellt virtuelle Maschinen
+
Das Shift Toolkit führt REST-API-Aufrufe durch, um je nach Betriebssystem die einzelnen VMs zu erstellen.

+

NOTE: VMs werden im Cluster „Standard“ erstellt.

** Schaltet VMs am Zielsystem ein
+
Abhängig vom VM-Betriebssystem weist das Shift Toolkit automatisch die VM-Startoption sowie die Speicherkontrollerschnittstellen zu.  Für Linux-Distributionen wird VirtIO oder VirtIO SCSI verwendet.  Bei Windows wird die VM mit der SATA-Schnittstelle gestartet, anschließend installiert das geplante Skript automatisch die VirtIO-Treiber und ändert die Schnittstelle auf VirtIO.

** Registriert Netzwerke auf jeder VM
+
Die Netzwerke werden auf Basis der Blueprint-Auswahl zugeordnet.

** Entfernt VMware Tools und weist IP-Adressen mithilfe von Trigger-Skripten oder Cronjobs zu.




.Beispiel anzeigen
[%collapsible]
====
image::shift-toolkit-212.png[Migrierte VMs in Oracle]

====


== Videodemonstration

Das folgende Video veranschaulicht den in dieser Lösung beschriebenen Prozess.

.Migration ohne Eingriff von ESX zu Oracle Linux Virtualization Manager (OLVM)
video::13bb74ad-25b3-49c0-84b5-b3760100ad6f[panopto]