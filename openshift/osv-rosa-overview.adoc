---
sidebar: sidebar 
permalink: openshift/osv-rosa-overview.html 
keywords: OpenShift, OCP, Trident, NetApp ONTAP, Red Hat OpenShift, OpenShift Virtualization, ROSA, CNV, Container Native Virtualization, Red Hat OpenShift Virtualization 
summary: Red Hat OpenShift-Virtualisierung auf ROSA 
---
= Bereitstellen von Red Hat OpenShift Virtualization mit FSx für ONTAP auf einem ROSA-Cluster
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
Richten Sie Amazon FSx for NetApp ONTAP als Standard-StorageClass für einen ROSA-Cluster (Red Hat OpenShift Service auf AWS) ein.  Dieses Verfahren umfasst das Erstellen einer VM, die FSx ONTAP -Speicher für ihre Volumes nutzt, das Überprüfen aller für die VM erstellten Objekte und das Herstellen einer Verbindung mit der VM mithilfe von Gastanmeldeinformationen.

Wir werden uns auch mit der Verbindung zur virtuellen Maschine mithilfe der Gastanmeldeinformationen und dem Neustart der VM befassen.  Und schließlich führen wir eine Live-Migration der virtuellen Maschine vom aktuellen Knoten auf einen neuen Knoten durch.  Wir untersuchen den Inhalt des Festplattenspeichers nach einem VM-Neustart und der Live-Migration.



== Voraussetzungen

* link:https://signin.aws.amazon.com/signin?redirect_uri=https://portal.aws.amazon.com/billing/signup/resume&client_id=signup["AWS-Konto"]
* link:https://console.redhat.com/["Ein Red Hat-Konto"]
* IAM-Benutzerlink:https://www.rosaworkshop.io/rosa/1-account_setup/["mit entsprechenden Berechtigungen"] zum Erstellen und Zugreifen auf den ROSA-Cluster
* link:https://aws.amazon.com/cli/["AWS CLI"]
* link:https://console.redhat.com/openshift/downloads["ROSA CLI"]
* link:https://console.redhat.com/openshift/downloads["OpenShift-Befehlszeilenschnittstelle"](oc)
* link:https://docs.aws.amazon.com/eks/latest/userguide/helm.html["Helm 3-Dokumentation"]
* link:https://docs.openshift.com/rosa/rosa_hcp/rosa-hcp-sts-creating-a-cluster-quickly.html["Ein HCP ROSA-Cluster"](mit mindestens 3 Bare-Metal-Worker-Knoten)
* link:https://console.redhat.com/openshift/overview["Zugriff auf die Red Hat OpenShift-Webkonsole"]
* Trident 25.02 oder höher. Informationen zu den oben genannten Trident -Voraussetzungen finden Sie unterlink:osv-trident-install.html["Trident -Installationsabschnitt"] für Details.
* link:https://docs.redhat.com/en/documentation/openshift_container_platform/4.17/html/virtualization/installing#virt-aws-bm_preparing-cluster-for-virt["OpenShift-Virtualisierung auf ROSA-Cluster installiert"]


Ab der Trident Version 25.02 können Sie die Worker-Knoten des ROSA-Clusters (oder eines beliebigen OpenShift-Clusters) problemlos für die Durchführung von iSCSI-Vorgängen auf FSxN-Speicher vorbereiten. Es gibt zwei einfache Möglichkeiten, Trident 25.02 (oder höher) zu installieren, das die Vorbereitung des Worker-Knotens für iSCSI automatisiert. Vor der Installation der OpenShift-Virtualisierung sollten Sie bereits das Trident-Backend, die Speicherklasse und die Volume-Snapshot-Klassenobjekte erstellt und als Standard eingerichtet haben.  Sie können sich auf dielink:osv-trident-install.html["Trident -Installationsabschnitt"] für Details.



== Ersteinrichtung

Richten Sie das Trident-Backend, die Speicherklasse und die VolumeSnapshotClass ein.  Sie können sich auf dielink:osv-trident-install.html["Trident -Installationsabschnitt"] für Details.

Beispiel-YAML zum Erstellen eines Trident-Backend-Objekts

[source, yaml]
----
cat tbc.yaml
apiVersion: v1
kind: Secret
metadata:
  name: backend-tbc-ontap-san-secret
type: Opaque
stringData:
  username: fsxadmin
  password: <password for the fsxN filesystem>
---
apiVersion: trident.netapp.io/v1
kind: TridentBackendConfig
metadata:
  name: backend-tbc-ontap-san
spec:
  version: 1
  storageDriverName: ontap-san
  managementLIF: <management lif of fsxN filesystem>
  backendName: backend-tbc-ontap-san
  svm: svm_FSxNForROSAiSCSI
  credentials:
    name: backend-tbc-ontap-san-secret

cat sc.yaml
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: trident-csi
provisioner: csi.trident.netapp.io
parameters:
  backendType: "ontap-san"
  media: "ssd"
  provisioningType: "thin"
  snapshots: "true"
allowVolumeExpansion: true

cat snapshot-class.yaml
apiVersion: snapshot.storage.k8s.io/v1
kind: VolumeSnapshotClass
metadata:
  name: fsx-snapclass
driver: csi.trident.netapp.io
deletionPolicy: Retain

#oc create -f tbc,yaml -n trident
#oc create -f sc.yaml
#oc create -f snapshot-class.yaml
----
Stellen Sie sicher, dass die Speicherklasse und die Volume-Snapshot-Klasse als Standard konfiguriert sind, bevor Sie die OpenShift-Virtualisierung installieren.  Weitere Informationen zum Einrichten von Standardeinstellungen finden Sie imlink:osv-trident-install.html["Festlegen von Standardeinstellungen mit dem Abschnitt „Trident Storage“ und „Snapshot Class“"] für Details.



=== **Erstellen Sie eine VM aus der Vorlage**

Verwenden Sie die Webkonsole, um eine VM aus einer Vorlage zu erstellen.  Erstellen Sie über die RedHat OpenShiftService-Konsole auf AWS eine virtuelle Maschine.  Auf dem Cluster sind Vorlagen verfügbar, die zum Erstellen der VM verwendet werden können.  Im Screenshot unten wählen wir Fedora VM aus dieser Liste aus.  Geben Sie der VM einen Namen und klicken Sie dann auf **Virtuelle Maschine anpassen**.  Wählen Sie die Registerkarte **Datenträger** und klicken Sie auf **Datenträger hinzufügen**.  Ändern Sie den Namen der Festplatte vorzugsweise in einen aussagekräftigen Namen und stellen Sie sicher, dass als Speicherklasse **trident-csi** ausgewählt ist.  Klicken Sie auf **Speichern**.  Klicken Sie auf **Virtuelle Maschine erstellen**

Nach einigen Minuten befindet sich die VM im laufenden Zustandimage:redhat-openshift-ocpv-rosa-003.png["OCP-v VM aus Vorlage erstellen"]

image:redhat-openshift-ocpv-rosa-004.png["OCP-v-Vorlagenquellen verfügbar"]

image:redhat-openshift-ocpv-rosa-005.png["OCP-v VM anpassen"]

image:redhat-openshift-ocpv-rosa-006.png["Registerkarte „OCP-v-Datenträger“"]

image:redhat-openshift-ocpv-rosa-007.png["OCP-v Datenträger hinzufügen"]

image:redhat-openshift-ocpv-rosa-008.png["OCP-v VM läuft"]



=== **Überprüfen Sie alle für die VM erstellten Objekte**

Die Speicherplatten.image:redhat-openshift-ocpv-rosa-009.png["OCP-v-Speicherplatten"]

Die Dateisysteme der VM zeigen die Partitionen, den Dateisystemtyp und die Mount-Punkte an.image:redhat-openshift-ocpv-rosa-010.png["OCP-v-Dateisysteme"]

Für die VM werden 2 PVCs erstellt, einer von der Boot-Festplatte und einer für die Hot-Plug-Festplatte.image:redhat-openshift-ocpv-rosa-011.png["OCP-v VM PVCs"]

Der PVC für die Startdiskette zeigt, dass der Zugriffsmodus „ReadWriteMany“ und die Speicherklasse „trident-csi“ ist.image:redhat-openshift-ocpv-rosa-012.png["OCP-v VM-Bootdiskette PVC"]

Ebenso zeigt der PVC für die Hot-Plug-Festplatte, dass der Zugriffsmodus „ReadWriteMany“ und die Speicherklasse „trident-csi“ ist.image:redhat-openshift-ocpv-rosa-013.png["OCP-v VM Hotplug-Festplatten-PVC"]

Im Screenshot unten können wir sehen, dass der Pod für die VM den Status „Wird ausgeführt“ hat.image:redhat-openshift-ocpv-rosa-014.png["OCP-v VM läuft"]

Hier sehen wir die beiden mit dem VM-Pod verknüpften Volumes und die beiden ihnen zugeordneten PVCs.image:redhat-openshift-ocpv-rosa-015.png["OCP-v VM PVCs und PVs"]



=== **Verbindung zur VM herstellen**

Klicken Sie auf die Schaltfläche „Webkonsole öffnen“ und melden Sie sich mit den Gastanmeldeinformationen an.image:redhat-openshift-ocpv-rosa-016.png["OCP-v VM-Verbindung"]

image:redhat-openshift-ocpv-rosa-017.png["OCP-v-Anmeldung"]

Geben Sie die folgenden Befehle ein

[source]
----
$ df (to display information about the disk space usage on a file system).
----
[source]
----
$ dd if=/dev/urandom of=random.dat bs=1M count=10240 (to create a file called random.dat in the home dir and fill it with random data).
----
Die Festplatte ist mit 11 GB Daten gefüllt.image:redhat-openshift-ocpv-rosa-018.png["OCP-v VM füllt die Festplatte"]

Verwenden Sie vi, um eine Beispieltextdatei zu erstellen, die wir zum Testen verwenden werden.image:redhat-openshift-ocpv-rosa-019.png["OCP-v erstellt eine Datei"]

**Ähnliche Blogs**

link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Unlock-Seamless-iSCSI-Storage-Integration-A-Guide-to-FSxN-on-ROSA-Clusters-for/ba-p/459124["Nahtlose iSCSI-Speicherintegration: Ein Leitfaden zu FSxN auf ROSA-Clustern für iSCSI"]

link:https://community.netapp.com/t5/Tech-ONTAP-Blogs/Simplifying-Trident-Installation-on-Red-Hat-OpenShift-with-the-New-Certified/ba-p/459710["Vereinfachung der Trident -Installation auf Red Hat OpenShift mit dem neuen Certified Trident Operator"]
