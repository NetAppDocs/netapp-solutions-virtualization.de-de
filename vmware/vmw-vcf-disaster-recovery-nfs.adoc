---
sidebar: sidebar 
permalink: vmware/vmw-vcf-disaster-recovery-nfs.html 
keywords: netapp, vmware, cloud, foundation, vcf, nfs 
summary: Disaster-Recovery-Lösung für VCF mit NetApp Disaster Recovery. 
---
= Implementierung der Notfallwiederherstellung mit NetApp Disaster Recovery
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
VCF-Notfallwiederherstellungslösung für NFS-Datenspeicher mit NetApp SnapMirror und NetApp Disaster Recovery

Die Replikation auf Blockebene von einem Produktionsstandort zu einem Disaster Recovery-Standort (DR) bietet eine robuste und kostengünstige Strategie zum Schutz von Workloads vor Standortausfällen und Datenbeschädigungen, einschließlich Ransomware-Angriffen.  Mithilfe der NetApp SnapMirror Replikation können VMware VCF 9-Workloaddomänen, die auf lokalen ONTAP Systemen ausgeführt werden (unter Verwendung von NFS- oder VMFS-Datenspeichern), auf ein sekundäres ONTAP -System repliziert werden, das sich in einem dafür vorgesehenen Wiederherstellungs-Rechenzentrum befindet, in dem auch VMware bereitgestellt wird.

Weitere Informationen finden Sie im Folgenden.link:https://docs.netapp.com/us-en/data-services-disaster-recovery/["NetApp Disaster Recovery -Dokumentation"] Die

Dieser Abschnitt beschreibt die Konfiguration von NetApp Disaster Recovery zur Einrichtung von Disaster Recovery für lokale VMware-VMs.

Das Setup umfasst:

* Erstellen eines NetApp Console Kontos und Bereitstellen eines Agenten.
* Hinzufügen von ONTAP Arrays zur NetApp Console zu den unter Verwaltung stehenden Systemen, um die Kommunikation zwischen VMware vCenter und ONTAP Speicher zu erleichtern.
* Konfigurieren der Replikation zwischen Standorten mit SnapMirror.
* Einrichten und Testen eines Wiederherstellungsplans zur Validierung der Failover-Bereitschaft.


NetApp Disaster Recovery ist in die NetApp Console integriert und ermöglicht es Unternehmen, ihre lokalen VMware vCenter- und ONTAP Speichersysteme nahtlos zu erkennen. Nach der Erkennung können Administratoren Ressourcengruppierungen definieren, Notfallwiederherstellungspläne erstellen, diese mit den entsprechenden Ressourcen verknüpfen und Failover- und Failback-Vorgänge einleiten oder testen. NetApp SnapMirror bietet eine effiziente Replikation auf Blockebene und stellt sicher, dass der DR-Standort durch inkrementelle Updates mit der Produktionsumgebung synchronisiert bleibt. Dies ermöglicht ein Recovery Point Objective (RPO) von nur fünf Minuten.

NetApp Disaster Recovery unterstützt auch unterbrechungsfreie Disaster-Recovery-Tests. Durch Nutzung der FlexClone -Technologie von ONTAP werden platzsparende, temporäre Kopien des NFS-Datenspeichers aus dem aktuellsten replizierten Snapshot erstellt – ohne Auswirkungen auf die Produktionsarbeitslast oder zusätzliche Speicherkosten. Nach dem Testen kann die Umgebung problemlos abgebaut werden, wobei die Integrität der replizierten Daten erhalten bleibt.

Im Falle eines tatsächlichen Failovers orchestriert die NetApp Console den Wiederherstellungsprozess und stellt geschützte virtuelle Maschinen am festgelegten DR-Standort mit minimalem Benutzereingriff automatisch wieder her. Wenn die primäre Site wiederhergestellt ist, kehrt der Dienst die SnapMirror -Beziehung um und repliziert alle Änderungen zurück auf die ursprüngliche Site, wodurch ein reibungsloses und kontrolliertes Failback ermöglicht wird.

Alle diese Funktionen werden im Vergleich zu herkömmlichen Disaster-Recovery-Lösungen zu deutlich geringeren Kosten bereitgestellt.

image::vmw-vcf-dr-nfs-001.png[NetApp Disaster Recovery]



== Erste Schritte

Um mit NetApp Disaster Recovery zu beginnen, verwenden Sie die NetApp Console und greifen Sie dann auf den Dienst zu.

. Melden Sie sich bei der NetApp Console an.
. Wählen Sie in der linken Navigationsleiste der NetApp Console „Schutz“ > „Notfallwiederherstellung“.
. Das NetApp Disaster Recovery Dashboard wird angezeigt.
+
image::vmw-vcf-dr-nfs-002.png[NetApp Disaster Recovery Dashboard]



Bevor Sie den Notfallwiederherstellungsplan konfigurieren, stellen Sie Folgendes sicher:link:https://docs.netapp.com/us-en/data-services-disaster-recovery/get-started/dr-prerequisites.html["Voraussetzungen"] werden erfüllt:

* Der Console-Agent ist in der NetApp Console eingerichtet.
* Die Agenteninstanz verfügt über Verbindungen zum Quell- und Ziel-Workload-Domänen-vCenter und zu den Speichersystemen.
* NetApp Data ONTAP Cluster zur Bereitstellung von NFS- oder VMFS-Datenspeichern.
* In der NetApp Console werden lokale NetApp -Speichersysteme hinzugefügt, die NFS- oder VMFS-Datenspeicher für VMware hosten.
* Bei der Verwendung von DNS-Namen sollte eine DNS-Auflösung vorhanden sein. Andernfalls verwenden Sie IP-Adressen für das vCenter.
* Die SnapMirror Replikation ist für die angegebenen NFS- oder VMFS-basierten Datenspeichervolumes konfiguriert.
* Stellen Sie sicher, dass die Umgebung über unterstützte Versionen von vCenter Server und ESXi-Servern verfügt.


Sobald die Verbindung zwischen Quell- und Zielstandort hergestellt ist, fahren Sie mit den Konfigurationsschritten fort. Dies sollte einige Klicks dauern und etwa 3 bis 5 Minuten dauern.

Hinweis: NetApp empfiehlt, den Console-Agenten am Zielstandort oder an einem dritten Standort bereitzustellen, damit der Agent über das Netzwerk mit Quell- und Zielressourcen kommunizieren kann.

In dieser Demonstration werden die Workload-Domänen mit ONTAP NFS-Speicher konfiguriert.  Die Schritte im Hinblick auf den Workflow bleiben für VMFS-basierte Datenspeicher gleich.

image::vmw-vcf-dr-nfs-003.png[NetApp Disaster Recovery – Ausführliche Informationen]



== NetApp Disaster Recovery -Konfiguration

Der erste Schritt bei der Vorbereitung auf die Notfallwiederherstellung besteht darin, die Quell-vCenter- und Speicherressourcen zu ermitteln und zu NetApp Disaster Recovery hinzuzufügen.

Öffnen Sie die NetApp Console und wählen Sie im linken Navigationsmenü „Schutz“ > „Notfallwiederherstellung“. Wählen Sie „Standorte“ und anschließend „Hinzufügen“. Geben Sie einen Namen für die neue Quellseite und deren Standorte ein. Wiederholen Sie den Schritt, um das Zielgelände und den Standort hinzuzufügen.

image::vmw-vcf-dr-nfs-004.png[NetApp Disaster Recovery – Ausführliche Informationen]

Fügen Sie die folgenden Plattformen hinzu:

* Quell-Workloaddomäne vCenter
* Ziel-Workloaddomäne vCenter.


Sobald die vCenter hinzugefügt wurden, wird die automatische Erkennung ausgelöst.



== Konfigurieren der Speicherreplikation zwischen Quellstandort-Array und Zielstandort-Array

SnapMirror ermöglicht die Datenreplikation in einer NetApp Umgebung. Die SnapMirror -Replikation basiert auf der NetApp Snapshot®-Technologie und ist äußerst effizient, da sie nur die Blöcke repliziert, die seit dem letzten Update geändert oder hinzugefügt wurden. SnapMirror lässt sich einfach mithilfe von NetApp OnCommand® System Manager oder der ONTAP CLI konfigurieren. NetApp Disaster Recovery erstellt außerdem die SnapMirror Beziehung, vorausgesetzt, Cluster- und SVM-Peering sind vorher konfiguriert.

Für Fälle, in denen der primäre Speicher nicht vollständig verloren geht, bietet SnapMirror eine effiziente Möglichkeit zur Resynchronisierung des primären Speichers und des DR-Standorts. SnapMirror kann die beiden Standorte neu synchronisieren, indem es lediglich geänderte oder neue Daten vom DR-Standort zurück zum primären Standort überträgt, indem es die SnapMirror Beziehungen umkehrt. Dies bedeutet, dass Replikationspläne in NetApp Disaster Recovery nach einem Failover in beide Richtungen resynchronisiert werden können, ohne dass das gesamte Volume neu kopiert werden muss. Wird eine Beziehung in umgekehrter Richtung resynchronisiert, werden nur neue Daten, die seit der letzten erfolgreichen Synchronisierung der Snapshot-Kopie geschrieben wurden, an das Ziel zurückgesendet.


NOTE: Wenn die SnapMirror Beziehung für das Volume bereits über die CLI oder den System Manager konfiguriert ist, erkennt NetApp Disaster Recovery die Beziehung und fährt mit den übrigen Workflow-Operationen fort.



== So richten Sie Replikationsbeziehungen für NetApp Disaster Recovery ein

Der zugrunde liegende Prozess zur Erstellung der SnapMirror Replikation bleibt für jede Anwendung derselbe.  Am einfachsten lässt sich dies durch die Nutzung von NetApp Disaster Recovery realisieren, das den Replikationsworkflow automatisiert, sofern die folgenden beiden Kriterien erfüllt sind: Der Prozess kann manuell oder automatisiert erfolgen. Am einfachsten ist es, NetApp Disaster Recovery zu nutzen, mit dem der Replizierungs-Workflow automatisiert wird, sofern die folgenden zwei Kriterien erfüllt sind:

* Quell- und Zielcluster haben eine Peer-Beziehung.
* Quell-SVM und Ziel-SVM haben eine Peer-Beziehung.


Die NetApp Console bietet außerdem eine alternative Möglichkeit zur Konfiguration der SnapMirror Replikation, indem das Quell ONTAP -System in der Umgebung einfach per Drag & Drop auf das Zielsystem gezogen wird, um den Assistenten auszulösen, der durch den restlichen Prozess führt.



== Was kann NetApp Disaster Recovery für Sie tun?

Nach dem Hinzufügen der Quell- und Zielstandorte führt NetApp Disaster Recovery eine automatische Tiefenerkennung durch und zeigt die VMs zusammen mit den zugehörigen Metadaten an. NetApp Disaster Recovery erkennt außerdem automatisch die von den VMs verwendeten Netzwerke und Portgruppen und trägt diese ein.

image::vmw-vcf-dr-nfs-005.png[NetApp Console Websites]

Nachdem die Standorte hinzugefügt wurden, konfigurieren Sie den Replikationsplan, indem Sie die Quell- und Ziel-vCenter-Plattformen auswählen und die Ressourcengruppen festlegen, die in den Plan aufgenommen werden sollen, sowie die Gruppierung, wie Anwendungen wiederhergestellt und eingeschaltet werden sollen, und die Zuordnung von Clustern und Netzwerken. Um den Wiederherstellungsplan zu definieren, navigieren Sie zur Registerkarte *Replikationspläne* und klicken Sie auf *Hinzufügen*.

In diesem Schritt können die VMs in Ressourcengruppen gruppiert werden. Mit NetApp Disaster Recovery -Ressourcengruppen können Sie eine Reihe abhängiger VMs in logische Gruppen zusammenfassen, die deren Startreihenfolge und Startverzögerungen enthalten, die bei der Wiederherstellung ausgeführt werden können. Ressourcengruppen können während der Erstellung des Replikationsplans oder über die Registerkarte „Ressourcengruppe“ in der linken Navigationsleiste erstellt werden.

Zuerst benennen Sie den Replikationsplan und wählen das Quell-vCenter und das Ziel-vCenter aus.

image::vmw-vcf-dr-nfs-006.png[NetApp Disaster Recovery Ziel-vCenter]

Im nächsten Schritt müssen Sie entscheiden, ob Sie einen Replikationsplan mit Ressourcengruppen, virtuellen Maschinen oder Datenspeichern erstellen möchten. Wählen Sie eine vorhandene Ressourcengruppe aus. Falls keine Ressourcengruppen erstellt wurden, hilft Ihnen der Assistent dabei, die benötigten virtuellen Maschinen anhand der Wiederherstellungsziele zu gruppieren (im Wesentlichen funktionale Ressourcengruppen zu erstellen). Dies hilft auch dabei, die Reihenfolge der Wiederherstellung von virtuellen Anwendungsmaschinen festzulegen.

image::vmw-vcf-dr-nfs-007.png[NetApp Disaster Recovery wählt VMs zum Schutz aus]


NOTE: Die Ressourcengruppe ermöglicht das Festlegen der Startreihenfolge per Drag-and-Drop-Funktion. Damit lässt sich die Reihenfolge, in der die VMs während des Wiederherstellungsprozesses eingeschaltet werden, einfach ändern.

Sobald die Ressourcengruppen über den Replikationsplan erstellt sind, besteht der nächste Schritt darin, die Zuordnung zu erstellen, um virtuelle Maschinen und Anwendungen im Katastrophenfall wiederherstellen zu können. In diesem Schritt legen Sie fest, wie die Ressourcen aus der Quellumgebung der Zielumgebung zugeordnet werden. Dazu gehören Rechenressourcen, virtuelle Netzwerke, IP-Anpassung, Pre- und Post-Skripte, Boot-Verzögerungen, Anwendungskonsistenz und so weiter. Für detaillierte Informationen siehelink:https://docs.netapp.com/us-en/data-services-disaster-recovery/use/drplan-create.html#map-source-resources-to-the-target["Erstellen eines Replikationsplans"] Die Wie bereits in den Voraussetzungen erwähnt, kann die SnapMirror Replikation im Voraus konfiguriert werden, oder DRaaS kann sie anhand des RPO und der Aufbewahrungsanzahl konfigurieren, die bei der Erstellung des Replikationsplans angegeben wurden.

Hinweis: Standardmäßig werden für Test- und Failover-Operationen die gleichen Mapping-Parameter verwendet. Um unterschiedliche Zuordnungen für die Testumgebung festzulegen, wählen Sie die Option „Testzuordnung“ aus, nachdem Sie das Kontrollkästchen „Gleiche Zuordnungen für Failover- und Testzuordnungen verwenden“ deaktiviert haben. Sobald die Ressourcenzuordnung abgeschlossen ist, klicken Sie auf Weiter.

image::vmw-vcf-dr-nfs-008.png[NetApp Notfallressourcenzuordnung]

Überprüfen Sie anschließend die erstellten Zuordnungen und klicken Sie dann auf „Plan hinzufügen“.

image::vmw-vcf-dr-nfs-009.png[Überprüfung der Ressourcenzuordnung für NetApp Disaster Recovery]


NOTE: VMs aus verschiedenen Volumes und SVMs können in einen Replikationsplan einbezogen werden. Je nach Platzierung der VM (ob auf demselben Volume oder auf einem separaten Volume innerhalb derselben SVM, oder auf separaten Volumes auf verschiedenen SVMs) erstellt NetApp Disaster Recovery einen Consistency Group Snapshot.

image::vmw-vcf-dr-nfs-010.png[NetApp Disaster Recovery]

Sobald der Plan erstellt ist, werden eine Reihe von Validierungen ausgelöst und die SnapMirror Replikation und -Zeitpläne entsprechend der Auswahl konfiguriert.

image::vmw-vcf-dr-nfs-011.png[Überwachung von NetApp Disaster Recovery]

NetApp Disaster Recovery umfasst die folgenden Arbeitsabläufe:

* Test-Failover (einschließlich regelmäßiger automatisierter Simulationen)
* Failovertest bereinigen
* Ausfallsicherung:
+
** Geplante Migration (Erweiterung des Anwendungsfalls für einmaliges Failover)
** Notfallwiederherstellung


* Failback


image::vmw-vcf-dr-nfs-012.png[Maßnahmen des NetApp Disaster Recovery]



== Testen des Failovers

Das Test-Failover in NetApp Disaster Recovery ist ein Betriebsverfahren, das es VMware-Administratoren ermöglicht, ihre Wiederherstellungspläne vollständig zu validieren, ohne ihre Produktionsumgebungen zu unterbrechen.

image::vmw-vcf-dr-nfs-013.png[NetApp Disaster Recovery Replikationsplan-Test-Failover]

NetApp Disaster Recovery bietet die Möglichkeit, den Snapshot als optionale Funktion im Test-Failover-Vorgang auszuwählen. Diese Funktion ermöglicht es dem VMware-Administrator zu überprüfen, ob alle kürzlich in der Umgebung vorgenommenen Änderungen auf den Zielstandort repliziert wurden und somit während des Tests vorhanden sind. Zu diesen Änderungen gehören Patches für das VM-Gastbetriebssystem.

image::vmw-vcf-dr-nfs-014.png[NetApp Disaster Recovery Replikationsplan-Test Failover-Bestätigung]

Wenn der VMware-Administrator einen Test-Failover durchführt, automatisiert NetApp Disaster Recovery die folgenden Aufgaben:

* Auslösen von SnapMirror -Beziehungen, um den Speicher am Zielstandort mit allen kürzlich am Produktionsstandort vorgenommenen Änderungen zu aktualisieren.
* Erstellen von NetApp FlexClone -Volumes der FlexVol -Volumes auf dem DR-Speicherarray.
* Verbinden der Datenspeicher in den FlexClone -Volumes mit den ESXi-Hosts am DR-Standort.
* Verbinden der VM-Netzwerkadapter mit dem während der Zuordnung angegebenen Testnetzwerk.
* Neukonfigurieren der Netzwerkeinstellungen des VM-Gastbetriebssystems wie für das Netzwerk am DR-Standort definiert.
* Ausführen aller benutzerdefinierten Befehle, die im Replikationsplan gespeichert wurden.
* Einschalten der VMs in der im Replikationsplan festgelegten Reihenfolge.


image::vmw-vcf-dr-nfs-015.png[NetApp Disaster Recovery Replikationsplan-Test-Failover-Ergebnis]



== Bereinigungs-Failover-Testvorgang

Der Bereinigungs-Failover-Testvorgang wird ausgeführt, nachdem der Replikationsplantest abgeschlossen wurde und der VMware-Administrator auf die Bereinigungsaufforderung reagiert.

image::vmw-vcf-dr-nfs-016.png[NetApp Disaster Recovery Replikationsplantest Failover-Bereinigung]

Diese Aktion setzt die virtuellen Maschinen (VMs) und den Status des Replikationsplans auf den Status „Bereit“ zurück. Wenn der VMware-Administrator eine Wiederherstellungsoperation durchführt, schließt NetApp Disaster Recovery den folgenden Prozess ab:

. Es schaltet jede wiederhergestellte VM in der FlexClone -Kopie aus, die zum Testen verwendet wurde.
. Es löscht das FlexClone Volume, das während des Tests zum Präsentieren der wiederhergestellten VMs verwendet wurde.




== Geplante Migration und Failover

NetApp Disaster Recovery bietet zwei Methoden zur Durchführung eines echten Failovers: geplante Migration und Failover. Die erste Methode, die geplante Migration, beinhaltet das Herunterfahren der VMs und die Synchronisierung der Speicherreplikation in den Prozess, um die VMs wiederherzustellen oder effektiv an den Zielstandort zu verschieben. Für die geplante Migration ist der Zugriff auf den Quellstandort erforderlich. Die zweite Methode, Failover, ist ein geplantes/ungeplantes Failover, bei dem die VMs am Zielstandort aus dem letzten Speicherreplikationsintervall wiederhergestellt werden, das abgeschlossen werden konnte. Je nach dem in der Lösung festgelegten RPO (Recovery Point Objective) ist im DR-Szenario mit einem gewissen Datenverlust zu rechnen.

image::vmw-vcf-dr-nfs-017.png[NetApp Disaster Recovery -Replikationsplan-Failover-Aktion]

image::vmw-vcf-dr-nfs-018.png[Bestätigung der Failover-Aktion des NetApp Disaster Recovery]

Wenn der VMware-Administrator einen Failover durchführt, automatisiert NetApp Disaster Recovery die folgenden Aufgaben:

* Unterbrechen und Failover der NetApp SnapMirror -Beziehungen.
* Verbinden Sie die replizierten Datenspeicher mit den ESXi-Hosts am DR-Standort.
* Verbinden Sie die VM-Netzwerkadapter mit dem entsprechenden Zielstandortnetzwerk.
* Konfigurieren Sie die Netzwerkeinstellungen des VM-Gastbetriebssystems neu, wie für das Netzwerk am Zielstandort definiert.
* Führen Sie alle benutzerdefinierten Befehle (sofern vorhanden) aus, die im Replikationsplan gespeichert wurden.
* Schalten Sie die VMs in der im Replikationsplan festgelegten Reihenfolge ein.


image::vmw-vcf-dr-nfs-019.png[vSphere-Client – VMs eingeschaltet]



== Failback

Ein Failback ist ein optionales Verfahren, das nach einer Wiederherstellung die ursprüngliche Konfiguration der Quell- und Zielsites wiederherstellt.

image::vmw-vcf-dr-nfs-020.png[NetApp Disaster Recovery Replikationsplan-Failback-Aktion]

VMware-Administratoren können ein Failback-Verfahren konfigurieren und ausführen, wenn sie bereit sind, die Dienste auf der ursprünglichen Quellsite wiederherzustellen.


NOTE: NetApp Disaster Recovery repliziert (resynchronisiert) alle Änderungen zurück auf die ursprüngliche virtuelle Quellmaschine, bevor die Replikationsrichtung umgekehrt wird.

Dieser Prozess beginnt mit einer Beziehung, deren Failover zu einem Ziel abgeschlossen ist, und umfasst die folgenden Schritte:

* Schalten Sie die virtuellen Maschinen aus und heben Sie die Registrierung auf. Die Volumes auf der Zielsite werden ausgehängt.
+
image::vmw-vcf-dr-nfs-021.png[vSphere-Client – kürzlich ausgeführte Aufgaben]

* Unterbrechen Sie die SnapMirror -Beziehung zur Originalquelle, um Lese-/Schreibzugriff zu ermöglichen.
* Synchronisieren Sie die SnapMirror -Beziehung erneut, um die Replikation umzukehren.
* Mounten Sie das Volume auf der Quelle, schalten Sie die virtuellen Quellmaschinen ein und registrieren Sie sie.
+
image::vmw-vcf-dr-nfs-022.png[vSphere-Client – VMs eingeschaltet]



Weitere Informationen zum Zugriff auf und zur Konfiguration von NetApp Disaster Recovery finden Sie unterlink:https://docs.netapp.com/us-en/data-services-disaster-recovery/get-started/dr-intro.html["Erfahren Sie mehr über NetApp Disaster Recovery für VMware"] Die



== Überwachung und Dashboard

Über NetApp Disaster Recovery oder die ONTAP CLI können Sie den Replikationsstatus der entsprechenden Datenspeichervolumes überwachen, und der Status eines Failovers oder Test-Failovers kann über die Jobüberwachung verfolgt werden.

image::vmw-vcf-dr-nfs-023.png[Überwachung von NetApp Disaster Recovery]


NOTE: Wenn ein Auftrag gerade ausgeführt wird oder sich in der Warteschlange befindet und Sie ihn stoppen möchten, können Sie ihn mit der Option „Abbrechen“ abbrechen.

Mit dem NetApp Disaster Recovery Dashboard können Sie den Status von Disaster-Recovery-Standorten und Replikationsplänen zuverlässig beurteilen. Dies ermöglicht es Administratoren, intakte, nicht verbundene oder beeinträchtigte Standorte und Pläne schnell zu identifizieren.

image::vmw-vcf-dr-nfs-024.png[NetApp Disaster Recovery – Aktualisiertes Dashboard]

Dies bietet eine leistungsstarke Lösung zur Handhabung eines maßgeschneiderten und individuellen Notfallwiederherstellungsplans. Das Failover kann als geplantes Failover oder per Mausklick erfolgen, wenn ein Notfall eintritt und die Entscheidung zur Aktivierung der DR-Site getroffen wird.
