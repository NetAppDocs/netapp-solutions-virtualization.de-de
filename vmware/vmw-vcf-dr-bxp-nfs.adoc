---
sidebar: sidebar 
permalink: vmware/vmw-vcf-dr-bxp-nfs.html 
keywords: netapp, vmware, cloud, foundation, vcf, bluexp, disaster recovery, nfs 
summary: Disaster-Recovery-Lösung für VCF mit BlueXP disaster recovery als Service. 
---
= Implementierung von Disaster Recovery mit NetApp SnapMirror und BlueXP DRaaS
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
VCF-Disaster-Recovery-Lösung für NFS-Datenspeicher mit NetApp SnapMirror und BlueXP DRaaS

Die Replikation auf Blockebene von einem Produktionsstandort zu einem Disaster Recovery-Standort (DR) bietet eine robuste und kostengünstige Strategie zum Schutz von Workloads vor Standortausfällen und Datenbeschädigungen, einschließlich Ransomware-Angriffen.  Mithilfe der NetApp SnapMirror Replikation können VMware VCF 9-Workloaddomänen, die auf lokalen ONTAP Systemen ausgeführt werden (unter Verwendung von NFS- oder VMFS-Datenspeichern), auf ein sekundäres ONTAP -System repliziert werden, das sich in einem dafür vorgesehenen Wiederherstellungs-Rechenzentrum befindet, in dem auch VMware bereitgestellt wird.

In diesem Abschnitt wird die Konfiguration von BlueXP Disaster Recovery as a Service (DRaaS) zur Einrichtung von DR für lokale virtuelle VMware-Maschinen beschrieben.

Das Setup umfasst:

* Erstellen eines BlueXP -Kontos und Bereitstellen eines BlueXP Connectors.
* Hinzufügen von ONTAP Arrays zum BlueXP Canvas, um die Kommunikation zwischen VMware vCenter und ONTAP -Speicher zu erleichtern.
* Konfigurieren der Replikation zwischen Standorten mit SnapMirror.
* Einrichten und Testen eines Wiederherstellungsplans zur Validierung der Failover-Bereitschaft.


Der in die NetApp BlueXP Konsole integrierte BlueXP disaster recovery -Dienst ermöglicht Unternehmen die nahtlose Erkennung ihrer lokalen VMware vCenter- und ONTAP Speichersysteme.  Nach der Erkennung können Administratoren Ressourcengruppierungen definieren, Notfallwiederherstellungspläne erstellen, diese mit den entsprechenden Ressourcen verknüpfen und Failover- und Failback-Vorgänge einleiten oder testen.  NetApp SnapMirror bietet eine effiziente Replikation auf Blockebene und stellt sicher, dass der DR-Standort durch inkrementelle Updates mit der Produktionsumgebung synchronisiert bleibt.  Dies ermöglicht ein Recovery Point Objective (RPO) von nur fünf Minuten.

BlueXP DRaaS unterstützt auch unterbrechungsfreie Disaster-Recovery-Tests.  Durch Nutzung der FlexClone -Technologie von ONTAP werden platzsparende, temporäre Kopien des NFS-Datenspeichers aus dem aktuellsten replizierten Snapshot erstellt – ohne Auswirkungen auf die Produktionsarbeitslast oder zusätzliche Speicherkosten.  Nach dem Testen kann die Umgebung problemlos abgebaut werden, wobei die Integrität der replizierten Daten erhalten bleibt.

Im Falle eines tatsächlichen Failovers orchestriert BlueXP den Wiederherstellungsprozess und ruft geschützte virtuelle Maschinen am vorgesehenen DR-Standort automatisch und mit minimalem Benutzereingriff auf.  Wenn die primäre Site wiederhergestellt ist, kehrt der Dienst die SnapMirror -Beziehung um und repliziert alle Änderungen zurück auf die ursprüngliche Site, wodurch ein reibungsloses und kontrolliertes Failback ermöglicht wird.

Alle diese Funktionen werden im Vergleich zu herkömmlichen Disaster-Recovery-Lösungen zu deutlich geringeren Kosten bereitgestellt.

image::vmw-vcf-dr-bxp-nfs-001.png[DR mit BlueXP -Architekturdiagramm]



== Erste Schritte

Um mit der BlueXP disaster recovery zu beginnen, verwenden Sie die BlueXP -Konsole und greifen Sie dann auf den Dienst zu.

. Melden Sie sich bei BlueXP an.
. Wählen Sie in der linken Navigationsleiste von BlueXP „Schutz“ > „Notfallwiederherstellung“ aus.
. Das BlueXP disaster recovery wird angezeigt.
+
image::vmw-vcf-dr-bxp-nfs-002.png[BlueXP DR Dashboard]



Stellen Sie vor der Konfiguration des Notfallwiederherstellungsplans Folgendes sicherlink:https://docs.netapp.com/us-en/bluexp-disaster-recovery/get-started/dr-prerequisites.html["Voraussetzungen"] erfüllt sind:

* BlueXP Connector wird in NetApp BlueXP eingerichtet.
* Die BlueXP Connector-Instanz verfügt über Konnektivität zum vCenter und den Speichersystemen der Quell- und Ziel-Workloaddomäne.
* NetApp Data ONTAP Cluster zur Bereitstellung von NFS- oder VMFS-Datenspeichern.
* In BlueXP werden lokale NetApp -Speichersysteme hinzugefügt, die NFS- oder VMFS-Datenspeicher für VMware hosten.
* Bei der Verwendung von DNS-Namen sollte eine DNS-Auflösung vorhanden sein. Andernfalls verwenden Sie IP-Adressen für das vCenter.
* Die SnapMirror Replikation ist für die angegebenen NFS- oder VMFS-basierten Datenspeichervolumes konfiguriert.
* Stellen Sie sicher, dass die Umgebung über unterstützte Versionen von vCenter Server und ESXi-Servern verfügt.


Sobald die Verbindung zwischen Quell- und Zielstandort hergestellt ist, fahren Sie mit den Konfigurationsschritten fort. Dies sollte einige Klicks dauern und etwa 3 bis 5 Minuten dauern.

Hinweis: NetApp empfiehlt, den BlueXP Connector am Zielstandort oder an einem dritten Standort bereitzustellen, damit der BlueXP Connector über das Netzwerk mit Quell- und Zielressourcen kommunizieren kann.

In dieser Demonstration werden die Workload-Domänen mit ONTAP NFS-Speicher konfiguriert.  Die Schritte im Hinblick auf den Workflow bleiben für VMFS-basierte Datenspeicher gleich.

image::vmw-vcf-dr-bxp-nfs-003.png[BlueXP detailliertes DR-Dashboard]



== BlueXP disaster recovery

Der erste Schritt bei der Vorbereitung der Notfallwiederherstellung besteht darin, die Quell-vCenter- und Speicherressourcen zu ermitteln und zur BlueXP disaster recovery hinzuzufügen.

Öffnen Sie die BlueXP -Konsole und wählen Sie in der linken Navigation „Schutz“ > „Notfallwiederherstellung“.  Wählen Sie „vCenter-Server ermitteln“ oder verwenden Sie das Hauptmenü. Wählen Sie „Sites > Hinzufügen > vCenter hinzufügen“.

Fügen Sie die folgenden Plattformen hinzu:

* Quell-Workloaddomäne vCenter
* Ziel-Workloaddomäne vCenter.


Sobald die vCenter hinzugefügt wurden, wird die automatische Erkennung ausgelöst.



== Konfigurieren der Speicherreplikation zwischen Quellstandort-Array und Zielstandort-Array

SnapMirror bietet Datenreplikation in einer NetApp Umgebung. Die SnapMirror -Replikation basiert auf der NetApp Snapshot®-Technologie und ist äußerst effizient, da sie nur die Blöcke repliziert, die seit dem letzten Update geändert oder hinzugefügt wurden.  SnapMirror lässt sich einfach mithilfe von NetApp OnCommand® System Manager oder der ONTAP CLI konfigurieren. BlueXP DRaaS erstellt auch die SnapMirror -Beziehung, sofern Cluster- und SVM-Peering zuvor konfiguriert wurden.

In Fällen, in denen der primäre Speicher nicht vollständig verloren geht, bietet SnapMirror eine effiziente Möglichkeit zur Neusynchronisierung der primären und DR-Sites. SnapMirror kann die beiden Sites neu synchronisieren und nur geänderte oder neue Daten von der DR-Site zurück zur primären Site übertragen, indem einfach die SnapMirror Beziehungen umgekehrt werden. Dies bedeutet, dass Replikationspläne in BlueXP DRaaS nach einem Failover in beide Richtungen neu synchronisiert werden können, ohne das gesamte Volume erneut zu kopieren. Wenn eine Beziehung in umgekehrter Richtung erneut synchronisiert wird, werden nur neue Daten an das Ziel zurückgesendet, die seit der letzten erfolgreichen Synchronisierung der Snapshot-Kopie geschrieben wurden.


NOTE: Wenn die SnapMirror -Beziehung für das Volume bereits über CLI oder System Manager konfiguriert ist, übernimmt BlueXP DRaaS die Beziehung und fährt mit den restlichen Workflow-Vorgängen fort.



== So richten Sie es für VMware Disaster Recovery ein

Der Vorgang zum Erstellen der SnapMirror Replikation bleibt für jede Anwendung derselbe. Der Vorgang kann manuell oder automatisiert erfolgen. Am einfachsten ist es, BlueXP DRaaS zu nutzen, das dies automatisiert, sofern die folgenden beiden Kriterien erfüllt sind:

* Quell- und Zielcluster haben eine Peer-Beziehung.
* Quell-SVM und Ziel-SVM haben eine Peer-Beziehung.


image::vmw-vcf-dr-bxp-nfs-004.png[BlueXP -Ressourcenzuordnung]

BlueXP bietet auch eine alternative Option zum Konfigurieren der SnapMirror Replikation durch einfaches Ziehen und Ablegen des Quell- ONTAP -Systems in der Umgebung auf das Ziel, um den Assistenten auszulösen, der durch den Rest des Prozesses führt.



== Was kann BlueXP disaster recovery für Sie tun?

Nachdem die Quell- und Zielsites hinzugefügt wurden, führt die BlueXP disaster recovery eine automatische Tiefenerkennung durch und zeigt die VMs zusammen mit den zugehörigen Metadaten an. Die BlueXP disaster recovery erkennt außerdem automatisch die von den VMs verwendeten Netzwerke und Portgruppen und füllt sie.

image::vmw-vcf-dr-bxp-nfs-005.png[BlueXP -Websites]

Nachdem die Sites hinzugefügt wurden, konfigurieren Sie den Replikationsplan, indem Sie die Quell- und Ziel-vCenter-Plattformen aus der Dropdown-Liste auswählen und die Ressourcengruppen auswählen, die in den Plan aufgenommen werden sollen, zusammen mit der Gruppierung, wie Anwendungen wiederhergestellt und eingeschaltet werden sollen, und der Zuordnung von Clustern und Netzwerken. Um den Wiederherstellungsplan zu definieren, navigieren Sie zur Registerkarte *Replikationsplan* und klicken Sie auf *Plan hinzufügen*.

In diesem Schritt können die VMs in Ressourcengruppen gruppiert werden. Mit den BlueXP disaster recovery können Sie eine Reihe abhängiger VMs in logische Gruppen gruppieren, die ihre Startreihenfolgen und Startverzögerungen enthalten, die bei der Wiederherstellung ausgeführt werden können.  Die Ressourcengruppe kann auch über die Registerkarte „Ressourcengruppe“ erstellt werden.

Wählen Sie zuerst das Quell-vCenter und dann das Ziel-vCenter aus.

image::vmw-vcf-dr-bxp-nfs-006.png[BlueXP -Ziel vCenter]

Der nächste Schritt besteht darin, vorhandene Ressourcengruppen auszuwählen. Wenn keine Ressourcengruppen erstellt wurden, hilft der Assistent dabei, die erforderlichen virtuellen Maschinen basierend auf den Wiederherstellungszielen zu gruppieren (im Wesentlichen funktionale Ressourcengruppen zu erstellen). Dies hilft auch dabei, die Vorgangsreihenfolge für die Wiederherstellung virtueller Anwendungsmaschinen zu definieren.

image::vmw-vcf-dr-bxp-nfs-007.png[BlueXP wählt VMs zum Schutz aus]


NOTE: Die Ressourcengruppe ermöglicht das Festlegen der Startreihenfolge per Drag-and-Drop-Funktion. Damit lässt sich die Reihenfolge, in der die VMs während des Wiederherstellungsprozesses eingeschaltet werden, einfach ändern.

Sobald die Ressourcengruppen über den Replikationsplan erstellt wurden, besteht der nächste Schritt darin, den Blueprint oder eine Zuordnung auszuwählen, um virtuelle Maschinen und Anwendungen im Katastrophenfall wiederherzustellen. Geben Sie in diesem Schritt an, wie die Ressourcen aus der Quellumgebung dem Ziel zugeordnet werden.  Dazu gehören Rechenressourcen, virtuelle Netzwerke, IP-Anpassung, Pre- und Post-Skripte, Boot-Verzögerungen, Anwendungskonsistenz und so weiter. Ausführliche Informationen finden Sie unterlink:https://docs.netapp.com/us-en/bluexp-disaster-recovery/use/drplan-create.html#map-source-resources-to-the-target["Erstellen eines Replikationsplans"] . Wie in den Voraussetzungen erwähnt, kann die SnapMirror Replikation im Voraus konfiguriert werden, oder DRaaS kann sie mithilfe des RPO und der Aufbewahrungsanzahl konfigurieren, die bei der Erstellung des Replikationsplans angegeben wurden.

Hinweis: Standardmäßig werden für Test- und Failover-Vorgänge dieselben Zuordnungsparameter verwendet.  Um unterschiedliche Zuordnungen für die Testumgebung festzulegen, wählen Sie die Option „Testzuordnung“ aus, nachdem Sie das Kontrollkästchen „Gleiche Zuordnungen für Failover- und Testzuordnungen verwenden“ deaktiviert haben. Klicken Sie nach Abschluss der Ressourcenzuordnung auf „Weiter“.

image::vmw-vcf-dr-bxp-nfs-008.png[BlueXP -Ressourcenzuordnung]

Überprüfen Sie anschließend die erstellten Zuordnungen und klicken Sie dann auf „Plan hinzufügen“.

image::vmw-vcf-dr-bxp-nfs-009.png[Überprüfung der BlueXP -Ressourcenzuordnung]


NOTE: VMs aus verschiedenen Volumes und SVMs können in einen Replikationsplan aufgenommen werden. Abhängig von der VM-Platzierung (sei es auf demselben Volume oder einem separaten Volume innerhalb derselben SVM, separate Volumes auf verschiedenen SVMs) erstellt die BlueXP disaster recovery einen Consistency Group Snapshot.

image::vmw-vcf-dr-bxp-nfs-010.png[BlueXP replication]

Sobald der Plan erstellt ist, werden eine Reihe von Validierungen ausgelöst und die SnapMirror Replikation und -Zeitpläne entsprechend der Auswahl konfiguriert.

image::vmw-vcf-dr-bxp-nfs-011.png[BlueXP Jobüberwachung]

BlueXP DRaaS besteht aus den folgenden Workflows:

* Test-Failover (einschließlich regelmäßiger automatisierter Simulationen)
* Failovertest bereinigen
* Ausfallsicherung:
+
** Geplante Migration (Erweiterung des Anwendungsfalls für einmaliges Failover)
** Notfallwiederherstellung


* Failback


image::vmw-vcf-dr-bxp-nfs-012.png[Aktionen des BlueXP replication]



== Testen des Failovers

Test-Failover in BlueXP DRaaS ist ein Betriebsverfahren, das es VMware-Administratoren ermöglicht, ihre Wiederherstellungspläne vollständig zu validieren, ohne ihre Produktionsumgebungen zu stören.

image::vmw-vcf-dr-bxp-nfs-013.png[BlueXP replication Test-Failover]

BlueXP DRaaS bietet die Möglichkeit, den Snapshot als optionale Funktion im Test-Failover-Vorgang auszuwählen. Mit dieser Funktion kann der VMware-Administrator überprüfen, ob alle kürzlich in der Umgebung vorgenommenen Änderungen auf die Zielsite repliziert werden und somit während des Tests vorhanden sind. Zu diesen Änderungen gehören Patches für das VM-Gastbetriebssystem.

image::vmw-vcf-dr-bxp-nfs-014.png[BlueXP replication Replikationsplan-Test-Failover-Bestätigung]

Wenn der VMware-Administrator einen Test-Failover-Vorgang ausführt, automatisiert BlueXP DRaaS die folgenden Aufgaben:

* Auslösen von SnapMirror -Beziehungen, um den Speicher am Zielstandort mit allen kürzlich am Produktionsstandort vorgenommenen Änderungen zu aktualisieren.
* Erstellen von NetApp FlexClone -Volumes der FlexVol -Volumes auf dem DR-Speicherarray.
* Verbinden der Datenspeicher in den FlexClone -Volumes mit den ESXi-Hosts am DR-Standort.
* Verbinden der VM-Netzwerkadapter mit dem während der Zuordnung angegebenen Testnetzwerk.
* Neukonfigurieren der Netzwerkeinstellungen des VM-Gastbetriebssystems wie für das Netzwerk am DR-Standort definiert.
* Ausführen aller benutzerdefinierten Befehle, die im Replikationsplan gespeichert wurden.
* Einschalten der VMs in der im Replikationsplan festgelegten Reihenfolge.


image::vmw-vcf-dr-bxp-nfs-015.png[BlueXP replication Replikationsplan-Test-Failover-Ergebnis]



== Bereinigungs-Failover-Testvorgang

Der Bereinigungs-Failover-Testvorgang wird ausgeführt, nachdem der Replikationsplantest abgeschlossen wurde und der VMware-Administrator auf die Bereinigungsaufforderung reagiert.

image::vmw-vcf-dr-bxp-nfs-016.png[BlueXP replication Test Failover Bereinigung]

Durch diese Aktion werden die virtuellen Maschinen (VMs) und der Status des Replikationsplans auf den Bereitschaftszustand zurückgesetzt. Wenn der VMware-Administrator einen Wiederherstellungsvorgang durchführt, führt BlueXP DRaaS den folgenden Prozess durch:

. Es schaltet jede wiederhergestellte VM in der FlexClone -Kopie aus, die zum Testen verwendet wurde.
. Es löscht das FlexClone Volume, das während des Tests zum Präsentieren der wiederhergestellten VMs verwendet wurde.




== Geplante Migration und Failover

BlueXP DRaaS bietet zwei Methoden zur Durchführung eines echten Failovers: geplante Migration und Failover. Bei der ersten Methode, der geplanten Migration, werden das Herunterfahren der VM und die Synchronisierung der Speicherreplikation in den Prozess integriert, um die VMs wiederherzustellen oder effektiv an den Zielstandort zu verschieben. Für die geplante Migration ist Zugriff auf die Quellsite erforderlich. Die zweite Methode, Failover, ist ein geplantes/ungeplantes Failover, bei dem die VMs am Zielstandort aus dem letzten Speicherreplikationsintervall wiederhergestellt werden, das abgeschlossen werden konnte. Abhängig vom RPO, das in die Lösung integriert wurde, ist im DR-Szenario mit einem gewissen Datenverlust zu rechnen.

image::vmw-vcf-dr-bxp-nfs-017.png[Failover-Aktion des BlueXP replication]

image::vmw-vcf-dr-bxp-nfs-018.png[Bestätigung der Failover-Aktion des BlueXP replication]

Wenn der VMware-Administrator einen Failover-Vorgang durchführt, automatisiert BlueXP DRaaS die folgenden Aufgaben:

* Unterbrechen und Failover der NetApp SnapMirror -Beziehungen.
* Verbinden Sie die replizierten Datenspeicher mit den ESXi-Hosts am DR-Standort.
* Verbinden Sie die VM-Netzwerkadapter mit dem entsprechenden Zielstandortnetzwerk.
* Konfigurieren Sie die Netzwerkeinstellungen des VM-Gastbetriebssystems neu, wie für das Netzwerk am Zielstandort definiert.
* Führen Sie alle benutzerdefinierten Befehle (sofern vorhanden) aus, die im Replikationsplan gespeichert wurden.
* Schalten Sie die VMs in der im Replikationsplan festgelegten Reihenfolge ein.


image::vmw-vcf-dr-bxp-nfs-019.png[vSphere-Client – VMs eingeschaltet]



== Failback

Ein Failback ist ein optionales Verfahren, das nach einer Wiederherstellung die ursprüngliche Konfiguration der Quell- und Zielsites wiederherstellt.

image::vmw-vcf-dr-bxp-nfs-020.png[Failback-Aktion des BlueXP replication]

VMware-Administratoren können ein Failback-Verfahren konfigurieren und ausführen, wenn sie bereit sind, die Dienste auf der ursprünglichen Quellsite wiederherzustellen.


NOTE: BlueXP DRaaS repliziert (resynchronisiert) alle Änderungen zurück zur ursprünglichen virtuellen Quellmaschine, bevor die Replikationsrichtung umgekehrt wird.

Dieser Prozess beginnt mit einer Beziehung, deren Failover zu einem Ziel abgeschlossen ist, und umfasst die folgenden Schritte:

* Schalten Sie die virtuellen Maschinen aus und heben Sie die Registrierung auf. Die Volumes auf der Zielsite werden ausgehängt.
+
image::vmw-vcf-dr-bxp-nfs-021.png[vSphere-Client – kürzlich ausgeführte Aufgaben]

* Unterbrechen Sie die SnapMirror -Beziehung zur Originalquelle, um Lese-/Schreibzugriff zu ermöglichen.
* Synchronisieren Sie die SnapMirror -Beziehung erneut, um die Replikation umzukehren.
* Mounten Sie das Volume auf der Quelle, schalten Sie die virtuellen Quellmaschinen ein und registrieren Sie sie.
+
image::vmw-vcf-dr-bxp-nfs-022.png[vSphere-Client – VMs eingeschaltet]



Weitere Informationen zum Zugriff auf und zur Konfiguration von BlueXP DRaaS finden Sie imlink:https://docs.netapp.com/us-en/bluexp-disaster-recovery/get-started/dr-intro.html["Erfahren Sie mehr über BlueXP Disaster Recovery für VMware"] .



== Überwachung und Dashboard

Von BlueXP oder der ONTAP CLI aus können Sie den Replikationszustand für die entsprechenden Datenspeichervolumes überwachen und den Status eines Failovers oder Testfailovers über die Jobüberwachung verfolgen.

image::vmw-vcf-dr-bxp-nfs-023.png[BlueXP Jobüberwachung]


NOTE: Wenn ein Auftrag gerade ausgeführt wird oder sich in der Warteschlange befindet und Sie ihn stoppen möchten, können Sie ihn mit der Option „Abbrechen“ abbrechen.

Mit dem BlueXP disaster recovery können Sie den Status von Notfallwiederherstellungsstandorten und Replikationsplänen zuverlässig bewerten. Dadurch können Administratoren schnell fehlerfreie, nicht verbundene oder beeinträchtigte Sites und Pläne identifizieren.

image::vmw-vcf-dr-bxp-nfs-024.png[BlueXP hat das Dr-Dashboard aktualisiert]

Dies bietet eine leistungsstarke Lösung zur Handhabung eines maßgeschneiderten und individuellen Notfallwiederherstellungsplans. Das Failover kann als geplantes Failover oder per Mausklick erfolgen, wenn ein Notfall eintritt und die Entscheidung zur Aktivierung der DR-Site getroffen wird.
