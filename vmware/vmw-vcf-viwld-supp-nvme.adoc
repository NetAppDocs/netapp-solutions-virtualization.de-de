---
sidebar: sidebar 
permalink: vmware/vmw-vcf-viwld-supp-nvme.html 
keywords: netapp, vmware, cloud, foundation, vcf, aff, all-flash, nfs, vvol, vvols, array, ontap tools, otv, sddc, iscsi 
summary:  
---
= Fügen Sie NVMe über TCP als zusätzlichen Speicher zu VI-Workloaddomänen hinzu
:hardbreaks:
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
In diesem Anwendungsfall beschreiben wir das Verfahren zur Verwendung von ONTAP Tools für VMware, um NVMe über TCP (NVMe/TCP) als zusätzlichen Speicher für eine Workload-Domäne der VMware Cloud Foundation (VCF) Virtual Infrastructure (VI) zu konfigurieren.  Dieses Verfahren fasst das Einrichten einer NVMe/TCP-fähigen Storage Virtual Machine (SVM), das Erstellen von NVMe-Namespaces, das Konfigurieren des ESXi-Hostnetzwerks und das Bereitstellen eines VMFS-Datenspeichers zusammen.



== Vorteile von NVMe gegenüber TCP

*Hohe Leistung:* Bietet außergewöhnliche Leistung mit geringer Latenz und hohen Datenübertragungsraten.  Dies ist für anspruchsvolle Anwendungen und umfangreiche Datenoperationen von entscheidender Bedeutung.

*Skalierbarkeit:* Unterstützt skalierbare Konfigurationen, sodass IT-Administratoren ihre Infrastruktur bei steigendem Datenbedarf nahtlos erweitern können.

*Kostengünstig:* Läuft über Standard-Ethernet-Switches und ist in TCP-Datagrammen gekapselt.  Zur Durchführung ist keine spezielle Ausrüstung erforderlich.

Weitere Informationen zu den Vorteilen von NVMe finden Sie unter https://www.netapp.com/data-storage/nvme/what-is-nvme/["Was ist NVME?"]



== Szenarioübersicht

Dieses Szenario umfasst die folgenden allgemeinen Schritte:

* Erstellen Sie eine Storage Virtual Machine (SVM) mit logischen Schnittstellen (LIFs) für NVMe/TCP-Verkehr.
* Erstellen Sie verteilte Portgruppen für iSCSI-Netzwerke in der VI-Workloaddomäne.
* Erstellen Sie VMkernel-Adapter für iSCSI auf den ESXi-Hosts für die VI-Workloaddomäne.
* Fügen Sie NVMe/TCP-Adapter auf ESXi-Hosts hinzu.
* Stellen Sie einen NVMe/TCP-Datenspeicher bereit.




== Voraussetzungen

Dieses Szenario erfordert die folgenden Komponenten und Konfigurationen:

* Ein ONTAP AFF oder ASA Speichersystem mit physischen Datenports auf Ethernet-Switches, die für den Speicherverkehr vorgesehen sind.
* Die Bereitstellung der VCF-Verwaltungsdomäne ist abgeschlossen und auf den vSphere-Client kann zugegriffen werden.
* Zuvor wurde eine VI-Workloaddomäne bereitgestellt.


NetApp empfiehlt vollständig redundante Netzwerkdesigns für NVMe/TCP.  Das folgende Diagramm zeigt ein Beispiel einer redundanten Konfiguration, die Fehlertoleranz für Speichersysteme, Switches, Netzwerkadapter und Hostsysteme bietet.  Weitere Informationen finden Sie in der NetApplink:https://docs.netapp.com/us-en/ontap/san-config/index.html["SAN-Konfigurationsreferenz"] für weitere Informationen.

image:vmware-vcf-asa-074.png["NVMe-TCP-Netzwerkdesign"]

Für Multipathing und Failover über mehrere Pfade empfiehlt NetApp , für alle SVMs in NVMe/TCP-Konfigurationen mindestens zwei LIFs pro Speicherknoten in separaten Ethernet-Netzwerken zu haben.

Diese Dokumentation veranschaulicht den Vorgang zum Erstellen einer neuen SVM und zum Angeben der IP-Adressinformationen zum Erstellen mehrerer LIFs für NVMe/TCP-Verkehr.  Informationen zum Hinzufügen neuer LIFs zu einem vorhandenen SVM finden Sie unterlink:https://docs.netapp.com/us-en/ontap/networking/create_a_lif.html["Erstellen Sie eine LIF (Netzwerkschnittstelle)"] .

Weitere Informationen zu NVMe-Designüberlegungen für ONTAP Speichersysteme finden Sie unterlink:https://docs.netapp.com/us-en/ontap/nvme/support-limitations.html["NVMe-Konfiguration, -Unterstützung und -Einschränkungen"] .



== Bereitstellungsschritte

Führen Sie die folgenden Schritte aus, um einen VMFS-Datenspeicher in einer VCF-Workloaddomäne mithilfe von NVMe/TCP zu erstellen.



=== Erstellen Sie SVM, LIFs und NVMe-Namespace auf dem ONTAP Speichersystem

Der folgende Schritt wird im ONTAP System Manager ausgeführt.

.Erstellen der Speicher-VM und LIFs
[%collapsible%open]
====
Führen Sie die folgenden Schritte aus, um eine SVM zusammen mit mehreren LIFs für NVMe/TCP-Verkehr zu erstellen.

. Navigieren Sie im ONTAP System Manager im linken Menü zu *Storage VMs* und klicken Sie zum Starten auf *+ Hinzufügen*.
+
image:vmware-vcf-asa-001.png["Klicken Sie auf +Hinzufügen, um mit der Erstellung des SVM zu beginnen"]

+
{nbsp}

. Geben Sie im Assistenten *Speicher-VM hinzufügen* einen *Namen* für die SVM ein, wählen Sie den *IP-Bereich* aus und klicken Sie dann unter *Zugriffsprotokoll* auf die Registerkarte *NVMe* und aktivieren Sie das Kontrollkästchen *NVMe/TCP aktivieren*.
+
image:vmware-vcf-asa-075.png["Assistent zum Hinzufügen von Speicher-VMs – NVMe/TCP aktivieren"]

+
{nbsp}

. Geben Sie im Abschnitt *Netzwerkschnittstelle* die *IP-Adresse*, *Subnetzmaske* und *Broadcast-Domäne und -Port* für das erste LIF ein.  Für nachfolgende LIFs kann das Kontrollkästchen aktiviert werden, um gemeinsame Einstellungen für alle verbleibenden LIFs zu verwenden oder separate Einstellungen zu verwenden.
+

NOTE: Für Multipathing und Failover über mehrere Pfade empfiehlt NetApp , für alle SVMs in NVMe/TCP-Konfigurationen mindestens zwei LIFs pro Speicherknoten in separaten Ethernet-Netzwerken zu haben.

+
image:vmware-vcf-asa-076.png["Netzwerkinformationen für LIFs ausfüllen"]

+
{nbsp}

. Wählen Sie, ob das Storage VM-Administrationskonto (für Umgebungen mit mehreren Mandanten) aktiviert werden soll, und klicken Sie auf *Speichern*, um die SVM zu erstellen.
+
image:vmware-vcf-asa-004.png["SVM-Konto aktivieren und abschließen"]



====
.Erstellen des NVMe-Namespace
[%collapsible%open]
====
NVMe-Namespaces sind analog zu LUNs für iSCSi oder FC.  Der NVMe-Namespace muss erstellt werden, bevor ein VMFS-Datenspeicher vom vSphere-Client bereitgestellt werden kann.  Um den NVMe-Namespace zu erstellen, muss zunächst der NVMe Qualified Name (NQN) von jedem ESXi-Host im Cluster abgerufen werden.  Der NQN wird von ONTAP verwendet, um die Zugriffskontrolle für den Namespace bereitzustellen.

Führen Sie die folgenden Schritte aus, um einen NVMe-Namespace zu erstellen:

. Öffnen Sie eine SSH-Sitzung mit einem ESXi-Host im Cluster, um dessen NQN zu erhalten.  Verwenden Sie den folgenden Befehl aus der CLI:
+
[source, cli]
----
esxcli nvme info get
----
+
Es sollte eine Ausgabe ähnlich der folgenden angezeigt werden:

+
[source, cli]
----
Host NQN: nqn.2014-08.com.netapp.sddc:nvme:vcf-wkld-esx01
----
. Notieren Sie den NQN für jeden ESXi-Host im Cluster
. Navigieren Sie im ONTAP System Manager im linken Menü zu *NVMe Namespaces* und klicken Sie zum Starten auf *+ Hinzufügen*.
+
image:vmware-vcf-asa-093.png["Klicken Sie auf +Hinzufügen, um den NVMe-Namespace zu erstellen"]

+
{nbsp}

. Geben Sie auf der Seite *NVMe-Namespace hinzufügen* ein Namenspräfix, die Anzahl der zu erstellenden Namespaces, die Größe des Namespaces und das Host-Betriebssystem ein, das auf den Namespace zugreifen wird.  Erstellen Sie im Abschnitt *Host-NQN* eine durch Kommas getrennte Liste der NQNs, die zuvor von den ESXi-Hosts gesammelt wurden, die auf die Namespaces zugreifen werden.


Klicken Sie auf *Weitere Optionen*, um zusätzliche Elemente wie die Snapshot-Schutzrichtlinie zu konfigurieren.  Klicken Sie abschließend auf *Speichern*, um den NVMe-Namespace zu erstellen.

+image:vmware-vcf-asa-093.png["Klicken Sie auf +Hinzufügen, um den NVMe-Namespace zu erstellen"]

====


=== Einrichten von Netzwerk- und NVMe-Softwareadaptern auf ESXi-Hosts

Die folgenden Schritte werden mithilfe des vSphere-Clients auf dem VI-Workload-Domänencluster ausgeführt.  In diesem Fall wird vCenter Single Sign-On verwendet, sodass der vSphere-Client sowohl für die Verwaltungs- als auch für die Workloaddomänen gleich ist.

.Erstellen Sie verteilte Portgruppen für NVME/TCP-Verkehr
[%collapsible%open]
====
Führen Sie die folgenden Schritte aus, um für jedes NVMe/TCP-Netzwerk eine neue verteilte Portgruppe zu erstellen:

. Navigieren Sie im vSphere-Client zu *Inventar > Netzwerk* für die Workloaddomäne.  Navigieren Sie zum vorhandenen Distributed Switch und wählen Sie die Aktion zum Erstellen einer *Neuen verteilten Portgruppe...*.
+
image:vmware-vcf-asa-022.png["Wählen Sie „Neue Portgruppe erstellen“"]

+
{nbsp}

. Geben Sie im Assistenten *Neue verteilte Portgruppe* einen Namen für die neue Portgruppe ein und klicken Sie auf *Weiter*, um fortzufahren.
. Füllen Sie auf der Seite *Einstellungen konfigurieren* alle Einstellungen aus.  Wenn VLANs verwendet werden, stellen Sie sicher, dass Sie die richtige VLAN-ID angeben. Klicken Sie auf *Weiter*, um fortzufahren.
+
image:vmware-vcf-asa-023.png["Füllen Sie die VLAN-ID aus"]

+
{nbsp}

. Überprüfen Sie auf der Seite *Bereit zum Abschließen* die Änderungen und klicken Sie auf *Fertig*, um die neue verteilte Portgruppe zu erstellen.
. Wiederholen Sie diesen Vorgang, um eine verteilte Portgruppe für das zweite verwendete NVMe/TCP-Netzwerk zu erstellen, und stellen Sie sicher, dass Sie die richtige *VLAN-ID* eingegeben haben.
. Nachdem beide Portgruppen erstellt wurden, navigieren Sie zur ersten Portgruppe und wählen Sie die Aktion „Einstellungen bearbeiten…“ aus.
+
image:vmware-vcf-asa-077.png["DPG - Einstellungen bearbeiten"]

+
{nbsp}

. Navigieren Sie auf der Seite *Verteilte Portgruppe – Einstellungen bearbeiten* im linken Menü zu *Teaming und Failover* und klicken Sie auf *Uplink2*, um es nach unten zu *Nicht verwendete Uplinks* zu verschieben.
+
image:vmware-vcf-asa-078.png["Verschiebe Uplink2 nach „Unbenutzt“"]

. Wiederholen Sie diesen Schritt für die zweite NVMe/TCP-Portgruppe.  Verschieben Sie dieses Mal jedoch *Uplink1* nach unten zu *Ungenutzte Uplinks*.
+
image:vmware-vcf-asa-079.png["Uplink 1 nach unbenutzt verschieben"]



====
.Erstellen Sie VMkernel-Adapter auf jedem ESXi-Host
[%collapsible%open]
====
Wiederholen Sie diesen Vorgang auf jedem ESXi-Host in der Workload-Domäne.

. Navigieren Sie vom vSphere-Client zu einem der ESXi-Hosts im Workload-Domäneninventar.  Wählen Sie auf der Registerkarte *Konfigurieren* *VMkernel-Adapter* aus und klicken Sie zum Starten auf *Netzwerk hinzufügen...*.
+
image:vmware-vcf-asa-030.png["Starten Sie den Assistenten zum Hinzufügen von Netzwerken"]

+
{nbsp}

. Wählen Sie im Fenster *Verbindungstyp auswählen* *VMkernel-Netzwerkadapter* und klicken Sie auf *Weiter*, um fortzufahren.
+
image:vmware-vcf-asa-008.png["Wählen Sie den VMkernel-Netzwerkadapter"]

+
{nbsp}

. Wählen Sie auf der Seite *Zielgerät auswählen* eine der zuvor erstellten verteilten Portgruppen für iSCSI aus.
+
image:vmware-vcf-asa-095.png["Zielportgruppe auswählen"]

+
{nbsp}

. Klicken Sie auf der Seite *Porteigenschaften* auf das Kontrollkästchen für *NVMe über TCP* und klicken Sie auf *Weiter*, um fortzufahren.
+
image:vmware-vcf-asa-096.png["VMkernel-Porteigenschaften"]

+
{nbsp}

. Geben Sie auf der Seite *IPv4-Einstellungen* die *IP-Adresse* und *Subnetzmaske* ein und geben Sie eine neue Gateway-IP-Adresse an (nur falls erforderlich). Klicken Sie auf *Weiter*, um fortzufahren.
+
image:vmware-vcf-asa-097.png["VMkernel-IPv4-Einstellungen"]

+
{nbsp}

. Überprüfen Sie Ihre Auswahl auf der Seite *Bereit zum Abschließen* und klicken Sie auf *Fertig*, um den VMkernel-Adapter zu erstellen.
+
image:vmware-vcf-asa-098.png["Überprüfen Sie die VMkernel-Auswahl"]

+
{nbsp}

. Wiederholen Sie diesen Vorgang, um einen VMkernel-Adapter für das zweite iSCSI-Netzwerk zu erstellen.


====
.NVMe-over-TCP-Adapter hinzufügen
[%collapsible%open]
====
Auf jedem ESXi-Host im Workload-Domänencluster muss für jedes eingerichtete NVMe/TCP-Netzwerk, das für Speicherverkehr vorgesehen ist, ein NVMe-over-TCP-Softwareadapter installiert sein.

Führen Sie die folgenden Schritte aus, um NVMe-over-TCP-Adapter zu installieren und die NVMe-Controller zu ermitteln:

. Navigieren Sie im vSphere-Client zu einem der ESXi-Hosts im Workload-Domänencluster.  Klicken Sie auf der Registerkarte *Konfigurieren* im Menü auf *Speicheradapter* und wählen Sie dann im Dropdown-Menü *Softwareadapter hinzufügen* die Option *NVMe-over-TCP-Adapter hinzufügen*.
+
image:vmware-vcf-asa-099.png["NVMe-over-TCP-Adapter hinzufügen"]

+
{nbsp}

. Rufen Sie im Fenster *Software-NVMe-over-TCP-Adapter hinzufügen* das Dropdown-Menü *Physischer Netzwerkadapter* auf und wählen Sie den richtigen physischen Netzwerkadapter aus, auf dem der NVMe-Adapter aktiviert werden soll.
+
image:vmware-vcf-asa-100.png["Physischen Adapter auswählen"]

+
{nbsp}

. Wiederholen Sie diesen Vorgang für das zweite Netzwerk, das NVMe über TCP-Verkehr zugewiesen ist, und weisen Sie den richtigen physischen Adapter zu.
. Wählen Sie einen der neu installierten NVMe-over-TCP-Adapter aus und wählen Sie auf der Registerkarte *Controller* die Option *Controller hinzufügen*.
+
image:vmware-vcf-asa-101.png["Controller hinzufügen"]

+
{nbsp}

. Wählen Sie im Fenster *Controller hinzufügen* die Registerkarte *Automatisch* und führen Sie die folgenden Schritte aus.
+
** Geben Sie eine IP-Adresse für eine der logischen SVM-Schnittstellen im selben Netzwerk ein wie der physische Adapter, der diesem NVMe-over-TCP-Adapter zugewiesen ist.
** Klicken Sie auf die Schaltfläche *Controller erkennen*.
** Aktivieren Sie in der Liste der erkannten Controller das Kontrollkästchen für die beiden Controller, deren Netzwerkadressen mit diesem NVMe-over-TCP-Adapter übereinstimmen.
** Klicken Sie auf die Schaltfläche *OK*, um die ausgewählten Controller hinzuzufügen.
+
image:vmware-vcf-asa-102.png["Controller entdecken und hinzufügen"]

+
{nbsp}



. Nach einigen Sekunden sollte der NVMe-Namespace auf der Registerkarte „Geräte“ angezeigt werden.
+
image:vmware-vcf-asa-103.png["NVMe-Namespace unter Geräten aufgeführt"]

+
{nbsp}

. Wiederholen Sie diesen Vorgang, um einen NVMe-over-TCP-Adapter für das zweite für NVMe/TCP-Verkehr eingerichtete Netzwerk zu erstellen.


====
.Bereitstellen eines NVMe-über-TCP-Datenspeichers
[%collapsible%open]
====
Führen Sie die folgenden Schritte aus, um einen VMFS-Datenspeicher im NVMe-Namespace zu erstellen:

. Navigieren Sie im vSphere-Client zu einem der ESXi-Hosts im Workload-Domänencluster.  Wählen Sie im Menü *Aktionen* die Option *Speicher > Neuer Datenspeicher...*.
+
image:vmware-vcf-asa-104.png["NVMe-over-TCP-Adapter hinzufügen"]

+
{nbsp}

. Wählen Sie im Assistenten *Neuer Datenspeicher* als Typ *VMFS* aus. Klicken Sie auf *Weiter*, um fortzufahren.
. Geben Sie auf der Seite *Namens- und Geräteauswahl* einen Namen für den Datenspeicher ein und wählen Sie den NVMe-Namespace aus der Liste der verfügbaren Geräte aus.
+
image:vmware-vcf-asa-105.png["Name und Geräteauswahl"]

+
{nbsp}

. Wählen Sie auf der Seite *VMFS-Version* die VMFS-Version für den Datenspeicher aus.
. Nehmen Sie auf der Seite *Partitionskonfiguration* die gewünschten Änderungen am Standardpartitionsschema vor. Klicken Sie auf *Weiter*, um fortzufahren.
+
image:vmware-vcf-asa-106.png["NVMe-Partitionskonfiguration"]

+
{nbsp}

. Überprüfen Sie auf der Seite *Bereit zum Abschließen* die Zusammenfassung und klicken Sie auf *Fertig*, um den Datenspeicher zu erstellen.
. Navigieren Sie zum neuen Datenspeicher im Inventar und klicken Sie auf die Registerkarte *Hosts*.  Bei korrekter Konfiguration sollten alle ESXi-Hosts im Cluster aufgelistet sein und Zugriff auf den neuen Datenspeicher haben.
+
image:vmware-vcf-asa-107.png["Mit dem Datenspeicher verbundene Hosts"]

+
{nbsp}



====


== Weitere Informationen

Informationen zur Konfiguration von ONTAP Speichersystemen finden Sie imlink:https://docs.netapp.com/us-en/ontap["ONTAP 9 Dokumentation"] Center.

Informationen zur Konfiguration von VCF finden Sie unterlink:https://techdocs.broadcom.com/us/en/vmware-cis/vcf.html["VMware Cloud Foundation-Dokumentation"] .
